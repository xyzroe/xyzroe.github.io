<!doctype html><html lang=en-us><head><title>Doorphone opener Zintercom / xyzroe's blog</title>
<link rel="shortcut icon" href=../../favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.121.1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="xyzroe"><meta name=description content><link rel=stylesheet href=//xyzroe.cc/css/main.min.e936c5013d179081bc7d200f84dcfe9c246ba63f93f7d53028d5ba8329bb286c.css><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-203059197-1","auto"),ga("send","pageview"))</script><meta name=twitter:card content="summary"><meta name=twitter:title content="Doorphone opener Zintercom"><meta name=twitter:description content="Board v2 available at GitHub Today I want to share with you the history of the development of a device for controlling a multi-apartment intercom using the Zigbee protocol.
Once upon a time I had an automatic doorphone opener based on: ESP8266, a module for two relays (16A) and a transistor with a strapping.
All this was collected on a bunch of wires and snot made of hot melt glue and looked something like the second photo."><meta property="og:title" content="Doorphone opener Zintercom"><meta property="og:description" content="Board v2 available at GitHub Today I want to share with you the history of the development of a device for controlling a multi-apartment intercom using the Zigbee protocol.
Once upon a time I had an automatic doorphone opener based on: ESP8266, a module for two relays (16A) and a transistor with a strapping.
All this was collected on a bunch of wires and snot made of hot melt glue and looked something like the second photo."><meta property="og:type" content="article"><meta property="og:url" content="//xyzroe.cc/posts/zintercom/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-15T00:00:00+00:00"><meta property="article:modified_time" content="2021-02-15T00:00:00+00:00"><script src=https://unpkg.com/feather-icons></script><link rel=stylesheet href=../../css/google-translate.css><script src=https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js></script><script src=../../js/google-translate.js></script><link rel=stylesheet href=../../css/accordion.css></head><body><header class=app-header><div class=notranslate><a href=//xyzroe.cc/><img class=app-header-avatar src=../../img/avatar.png alt=xyzroe></a><h1></h1><nav class=app-header-menu><a class=app-header-menu-item href=../../>Home</a>
-
<a class=app-header-menu-item href=../../links/>Links</a>
-
<a class=app-header-menu-item href=../../about/>About</a>
-
<a class=app-header-menu-item href=../../tags/>Tags</a></nav><p>Technical automation, some DIY stuff, little useful scripts, electronic devices development</p><div class=app-header-social><a href=https://t.me/xyzroe target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-send"><title>Telergam</title><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></a><a href=mailto:xyzroe@mind.in.ua target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>Email</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg></a><a href=https://github.com/xyzroe target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>Github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div><div class=app-footer><br><a rel="Made in Ukraine" target=_blank href=https://stand-with-ukraine.pp.ua><img alt="Made in Ukraine" style=border-width:0 src="https://img.shields.io/badge/made_in-ukraine-ffd700.svg?labelColor=0057b7"></a><br><br><a rel=license target=_blank href=http://creativecommons.org/licenses/by-sa/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-sa/4.0/88x31.png></a></div><div class=app-footer>&copy; 2020<script>(new Date).getFullYear()>2010&&document.write(" - "+(new Date).getFullYear())</script></div><div class=language><a href=# alt=EN data-google-lang=en class=language__img>ğŸ‡¬ğŸ‡§</a>
<a href=# alt=UA data-google-lang=uk class=language__img>ğŸ‡ºğŸ‡¦</a>
<a href=# alt=PL data-google-lang=pl class=language__img>ğŸ‡µğŸ‡±</a>
<a href=# alt=IL data-google-lang=iw class=language__img>ğŸ‡®ğŸ‡±</a>
<a href=# alt=DE data-google-lang=de class=language__img>ğŸ‡©ğŸ‡ª</a>
<a href=# alt=FR data-google-lang=fr class=language__img>ğŸ‡«ğŸ‡·</a>
<a href=# alt=ES data-google-lang=es class=language__img>ğŸ‡ªğŸ‡¸</a>
<a href=# alt=IT data-google-lang=it class=language__img>ğŸ‡®ğŸ‡¹</a>
<a href=# alt=NL data-google-lang=nl class=language__img>ğŸ‡³ğŸ‡±</a>
<a href=# alt=ZH data-google-lang=zh-CN class=language__img>ğŸ‡¨ğŸ‡³</a>
<img src=../../img/ru.png alt=ru data-google-lang=ru class=language__img height=10></div></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Doorphone opener Zintercom</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Feb 15, 2021</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=//xyzroe.cc/tags/zigbee/>Zigbee</a>
<a class=tag href=//xyzroe.cc/tags/domophone/>domophone</a>
<a class=tag href=//xyzroe.cc/tags/diy/>DIY</a></div></div></header><div class=post-content><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin=anonymous><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><h4 id=board-v2-available-at-githubhttpsgithubcomdiyruzzintercom-hahahugoshortcode16s1hbhb>Board v2 available at <a href=https://github.com/diyruz/Zintercom/>GitHub</a>
<a href=https://github.com/diyruz/Zintercom/><i data-feather=github stroke-width=2 width=24 height=24 color style=position:relative;top:10px></i>
<span class=screen-reader-text></span></a></h4><p>Today I want to share with you the history of the development of a device for controlling a multi-apartment intercom using the Zigbee protocol.</p><p>Once upon a time I had an automatic doorphone opener based on: ESP8266, a module for two relays (16A) and a transistor with a strapping.</p><p>All this was collected on a bunch of wires and snot made of hot melt glue and looked something like the second photo.<div class="gallery caption-position-bottom caption-effect-slide hover-effect-zoom hover-transition" itemscope itemtype=http://schema.org/ImageGallery><link rel=stylesheet href=../../css/hugo-easy-gallery.css><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img style=background-image:url(v1/photos.jpg)><img itemprop=thumbnail src=v1/photos.jpg alt=Zintercom></div><a href=v1/photos.jpg itemprop=contentUrl></a><figcaption><p>Zintercom</p></figcaption></figure></div><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img style=background-image:url(v1/phone.jpg)><img itemprop=thumbnail src=v1/phone.jpg alt="My intercom phone"></div><a href=v1/phone.jpg itemprop=contentUrl></a><figcaption><p>My intercom phone</p></figcaption></figure></div><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img style=background-image:url(v1/esp.jpg)><img itemprop=thumbnail src=v1/esp.jpg alt="Relay module and transistor in the socket behind the tube"></div><a href=v1/esp.jpg itemprop=contentUrl></a><figcaption><p>Relay module and transistor in the socket behind the tube</p></figcaption></figure></div></div></p><p>After organizing a Zigbee network at home, there was a desire to transfer as many devices as possible from to Zigbee in order to unload the Wi-Fi network (now there are 32 devices on Zigbee, and 20 devices on Wi-Fi).</p><p>Inspired by Jager devices and Anonymous firmware, it was decided to make an intercom opener on Zigbee. Surfing the vastness of the network, I came across a project of a similar doorphone opener, authored by Alexander Vaidurov.</p><p>I really liked the idea of â€‹â€‹using optocouplers instead of relays and the option of battery power supply for the device. With his consent, it was decided to use the part of the circuit responsible for working with the intercom line, but to make the control on the CC2530 chip.</p><p>The following scheme turned out:</p><div class=box style=max-width:90%><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img><img itemprop=thumbnail src=v1/Schematic_Zintercom.png></div><a href=v1/Schematic_Zintercom.png itemprop=contentUrl></a></figure></div><p>Then I spread the board and ordered it from the Chinese.<div class=box style=max-width:45%><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img><img itemprop=thumbnail src=v1/dimensions.png></div><a href=v1/dimensions.png itemprop=contentUrl></a></figure></div></p><p>I wanted to place an order before the holidays, and hastened. As a result, there were a couple of small mistakes that had to be corrected with jumpers.</p><p>(Don&rsquo;t rush! Don&rsquo;t repeat my mistakes)</p><p>There was also a discount coupon - decided to try a surface mount order. It turned out about $ 18. (This is more of a curiosity than a real need - the soldering is very simple)</p><p><div class="box fancy-figure caption-position-bottom" style=max-width:45%><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img><img itemprop=thumbnail src=v1/jlcpcb_order.jpg alt="Received boards"></div><a href=v1/jlcpcb_order.jpg itemprop=contentUrl></a><figcaption><p>Received boards</p></figcaption></figure></div><div class="box fancy-figure caption-position-bottom" style=max-width:20%><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img><img itemprop=thumbnail src=v1/jlcpcb_brelok.jpg alt="and a gift"></div><a href=v1/jlcpcb_brelok.jpg itemprop=contentUrl></a><figcaption><p>and a gift</p></figcaption></figure></div></p><p>While the boards were being manufactured and driving, the firmware for the device was written and a converter for zigbee2mqtt was made.</p><p>Dashboard zigbee2mqtt<div class=box style=max-width:45%><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img><img itemprop=thumbnail src=v1/z2m_dashboard.gif></div><a href=v1/z2m_dashboard.gif itemprop=contentUrl></a></figure></div>Exposes zigbee2mqtt<div class=box style=max-width:75%><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img><img itemprop=thumbnail src=v1/z2m_exposes.png></div><a href=v1/z2m_exposes.png itemprop=contentUrl></a></figure></div>In total, what opportunities do we have:</p><ul><li><p>Receive notification when the intercom rings (OnOff direct binding is also supported)</p></li><li><p>Do not interfere with the intercom (Never mode)</p></li><li><p>Automatically open to everyone (Always mode)</p></li><li><p>Open the door once during a call, or at the first call after switching on (Once mode)</p></li><li><p>Dump all incoming (Drop mode)</p></li><li><p>Mute the sound on the intercom handset (or use it without a handset at all)</p></li></ul><p>Call time, waiting time, opening time and report sending interval are configured through exposes.</p><p>For debugging, a second-hand semi-working set of the digital outdoor panel and the Vizit handset was purchased for symbolic money (about $ 15)</p><p>Video demonstrating different operating modes (1.5X)</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://player.vimeo.com/video/537687929 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="vimeo video" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p>In the course of debugging and testing, there were some changes:</p><p>Some resistors and capacitors have been changed
Fixed a couple of bugs in the PCB layout
Removed space for 2032 (change too often)
Removed micro USB connector (too inconvenient soldering)<div class=box style=max-width:70%><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img><img itemprop=thumbnail src=v1/usb.jpg></div><a href=v1/usb.jpg itemprop=contentUrl></a></figure></div>Final renders</p><div class="gallery caption-position-bottom caption-effect-slide hover-effect-zoom hover-transition" itemscope itemtype=http://schema.org/ImageGallery><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img style=background-image:url(v1/front_side.png)><img itemprop=thumbnail src=v1/front_side.png alt=Front></div><a href=v1/front_side.png itemprop=contentUrl></a><figcaption><p>Front</p></figcaption></figure></div><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img style=background-image:url(v1/back_DC_5-9V.png)><img itemprop=thumbnail src=v1/back_DC_5-9V.png alt="Back 5-9V"></div><a href=v1/back_DC_5-9V.png itemprop=contentUrl></a><figcaption><p>Back 5-9V</p></figcaption></figure></div><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img style=background-image:url(v1/back_2xAAA.png)><img itemprop=thumbnail src=v1/back_2xAAA.png alt="Back 2 * AAA holder"></div><a href=v1/back_2xAAA.png itemprop=contentUrl></a><figcaption><p>Back 2 * AAA holder</p></figcaption></figure></div></div><p>Differences between constant and battery power supply:</p><p>With constant:</p><p>Interval for sending reports - 1 minute
Battery status is not sent
Router or end device mode</p><p>With battery (E18-MS1-PCB only):</p><p>Interval for sending reports - 30 minutes
Battery status is sent after every event (call / button press)
End device mode only
Since the device is in sleep mode, it cannot receive commands, but it is possible to change the mode with a button or Zigbee command at the time of a call.</p><p>Do not turn off the sound, because it keeps the U2 on all the time, which drains the battery much faster.
If any commands are in the coordinator&rsquo;s queue, they will be executed when the device wakes up - after pressing a button or after receiving an incoming one.</p><p>After all the tests, I installed the board in the intercom tube case:</p><div class=box style=max-width:35%><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img><img itemprop=thumbnail src=v1/inside.jpg></div><a href=v1/inside.jpg itemprop=contentUrl></a></figure></div><p>Firmware, diagrams, Gerbers are open and are on the project&rsquo;s <a href=https://github.com/xyzroe/Zintercom/>Github repository</a>
<a href=https://github.com/xyzroe/Zintercom/><i data-feather=github stroke-width=2 width=32 height=30 color style=position:relative;top:10px></i>
<span class=screen-reader-text></span></a></p></div><div class=post-footer></div></article></main><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=../../js/load-photoswipe.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin=anonymous></script><script>feather.replace()</script></body></html>